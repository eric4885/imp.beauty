<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Imp Beauty - Spider Solitaire</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --card-width: 8vw;
      --card-height: calc(var(--card-width) * 1.4);
      --card-radius: 8px;
      --card-shadow: 0 4px 12px rgba(0,0,0,0.2);
      --red-suit: #FF3B30;
    }
    body { background-color: #1C1C1E; overflow-x: hidden; }
    .card-container {
      width: var(--card-width);
      height: var(--card-height);
      position: absolute;
      transform-style: preserve-3d;
      transition: transform 0.3s;
      cursor: pointer;
    }
    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: var(--card-radius);
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      background: white;
    }
    .card-front.is-red { color: var(--red-suit); }
    .card-back {
      background-color: #2C2C2E;
      transform: rotateY(180deg);
      display: flex; justify-content: center; align-items: center;
      color: white; font-weight: bold;
    }
    .card-container.is-flipped { transform: rotateY(180deg); }
    .tableau-pile { position: relative; min-height: 60vh; }
    .tableau-pile .card-container { top: calc(var(--i) * 18%); }
    #stock-pile {
      width: var(--card-width);
      height: var(--card-height);
      position: relative;
      cursor: pointer;
    }
    .foundation-pile {
      width: var(--card-width);
      height: var(--card-height);
      background: #2C2C2E;
      border-radius: var(--card-radius);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
    }
    #fireworks {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      display: none;
      z-index: 9999;
    }
    #win-message {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      color: white;
      font-size: 3rem;
      font-weight: bold;
      text-shadow: 0 0 10px black;
      display: none;
      text-align: center;
      z-index: 10000;
    }
    .btn {
      background: #0A84FF;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover { background: #007AFF; }
  </style>
</head>
<body class="font-sans antialiased text-white">
  <div class="p-4 md:p-8">
    <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-gray-200">Imp Beauty</h1>
    <p class="text-center text-gray-400 mb-6">Play Spider Solitaire online â€” a classic patience game with 4 suits.</p>
    <div id="game-stats" class="flex justify-between items-center mb-4 text-gray-300">
      <div>
        <span id="moves-counter">Moves: 0</span> |
        <span id="timer-counter">Time: 00:00</span>
      </div>
      <button id="restart-btn-top" class="btn">Restart</button>
    </div>
    <div class="flex justify-between items-start mb-4">
      <div id="stock-pile">
        <div class="card-face card-back">IMP</div>
      </div>
      <div id="foundations" class="flex flex-wrap justify-end gap-2"></div>
    </div>
    <div id="game-board" class="grid grid-cols-5 md:grid-cols-10 gap-2 md:gap-4">
      <div id="pile-0" class="tableau-pile"></div>
      <div id="pile-1" class="tableau-pile"></div>
      <div id="pile-2" class="tableau-pile"></div>
      <div id="pile-3" class="tableau-pile"></div>
      <div id="pile-4" class="tableau-pile"></div>
      <div id="pile-5" class="tableau-pile"></div>
      <div id="pile-6" class="tableau-pile"></div>
      <div id="pile-7" class="tableau-pile"></div>
      <div id="pile-8" class="tableau-pile"></div>
      <div id="pile-9" class="tableau-pile"></div>
    </div>
  </div>

  <canvas id="fireworks"></canvas>
  <div id="win-message">
    ðŸŽ‰ YOU WIN ðŸŽ‰<br>
    <button id="restart-btn-win" class="btn mt-4">Restart</button>
  </div>

  <script>
    class Card {
      constructor(suit,value,name){this.suit=suit;this.value=value;this.name=name;this.isFaceUp=false;}
    }

    function createAndShuffleDeck(){
      const suits=['spades','hearts','clubs','diamonds'];
      const values=[1,2,3,4,5,6,7,8,9,10,11,12,13];
      const names={1:'A',11:'J',12:'Q',13:'K'};
      let deck=[];
      for(let i=0;i<2;i++){
        for(const s of suits){
          for(const v of values){
            deck.push(new Card(s,v,names[v]||v));
          }
        }
      }
      for(let i=deck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [deck[i],deck[j]]=[deck[j],deck[i]];
      }
      return deck;
    }

    function initGame(deck){
      let state={tableau:Array.from({length:10},()=>[]),stock:[],found:[],moves:0};
      let idx=0,deal=[6,6,6,6,5,5,5,5,5,5];
      for(let p=0;p<10;p++){
        for(let i=0;i<deal[p];i++) state.tableau[p].push(deck[idx++]);
        state.tableau[p].at(-1).isFaceUp=true;
      }
      state.stock=deck.slice(idx);
      startTimer();
      return state;
    }

    let state,dragged,dragFrom,timer,startT;

    function startTimer(){startT=Date.now();timer=setInterval(()=>{let t=Date.now()-startT;let m=String(Math.floor(t/60000)).padStart(2,'0');let s=String(Math.floor((t%60000)/1000)).padStart(2,'0');document.getElementById("timer-counter").textContent=`Time: ${m}:${s}`;},1000);}

    function render(){
      document.getElementById("moves-counter").textContent=`Moves: ${state.moves}`;
      state.tableau.forEach((pile,pi)=>{
        let pe=document.getElementById(`pile-${pi}`);pe.innerHTML="";
        pile.forEach((c,ci)=>{
          let div=document.createElement("div");
          div.className="card-container"+(c.isFaceUp?" is-flipped":"");
          div.style.setProperty("--i",ci);
          div.dataset.pile=pi;div.dataset.idx=ci;
          let f=document.createElement("div");
          f.className=`card-face card-front ${(c.suit==='hearts'||c.suit==='diamonds')?'is-red':''}`;
          f.innerHTML=`<span>${c.name}</span><span>${suit(c.suit)}</span>`;
          let b=document.createElement("div");b.className="card-face card-back";b.textContent="IMP";
          div.append(b,f);
          if(c.isFaceUp){div.onmousedown=startDrag;div.ontouchstart=startDrag;}
          pe.appendChild(div);
        });
      });
      document.getElementById("stock-pile").style.opacity=state.stock.length?1:0.3;
      renderFoundations();
    }

    function renderFoundations(){
      let f=document.getElementById("foundations");f.innerHTML="";
      state.found.forEach(set=>{
        let pile=document.createElement("div");pile.className="foundation-pile";pile.textContent="âœ”";f.appendChild(pile);
      });
    }

    function suit(s){return {spades:"â™ ",hearts:"â™¥",clubs:"â™£",diamonds:"â™¦"}[s];}

    function startDrag(e){
      const el=e.target.closest(".card-container");
      dragFrom={pile:+el.dataset.pile,idx:+el.dataset.idx};
      dragged=Array.from(el.parentElement.children).slice(dragFrom.idx);
      dragged.forEach((c,i)=>{c.style.zIndex=1000;});
      document.addEventListener("mousemove",drag);document.addEventListener("mouseup",endDrag);
      document.addEventListener("touchmove",drag);document.addEventListener("touchend",endDrag);
    }
    function drag(e){
      if(!dragged) return;
      const x=e.clientX||e.touches[0].clientX,y=e.clientY||e.touches[0].clientY;
      dragged.forEach((c,i)=>{c.style.left=x+"px";c.style.top=(y+i*25)+"px";c.style.position="fixed";});
    }
    function endDrag(e){
      let x=e.clientX||e.changedTouches[0].clientX,y=e.clientY||e.changedTouches[0].clientY;
      let target=[...document.querySelectorAll(".tableau-pile")].find(p=>{
        let r=p.getBoundingClientRect();return x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom;
      });
      let moving=state.tableau[dragFrom.pile].slice(dragFrom.idx);
      if(target){
        let ti=+target.id.split("-")[1];let tp=state.tableau[ti];
        if(valid(moving,tp)){
          state.tableau[dragFrom.pile].splice(dragFrom.idx);
          tp.push(...moving);
          if(state.tableau[dragFrom.pile].length) state.tableau[dragFrom.pile].at(-1).isFaceUp=true;
          state.moves++;
          checkFoundation(ti);
        }
      }
      dragged=null;render();
    }

    function valid(moving,target){
      if(!target.length) return moving[0].value===13;
      return moving[0].value===target.at(-1).value-1;
    }

    function deal(){
      if(!state.stock.length) return;
      for(let i=0;i<10;i++) state.tableau[i].push({...state.stock.shift(),isFaceUp:true});
      state.moves++;render();
    }

    function checkFoundation(pileIdx){
      let pile=state.tableau[pileIdx];
      if(pile.length<13) return;
      let last13=pile.slice(-13);
      let s=last13[0].suit;
      for(let i=0;i<13;i++){if(last13[i].suit!==s||last13[i].value!==13-i)return;}
      state.tableau[pileIdx]=pile.slice(0,-13);
      state.found.push(last13);
      state.moves++;
      if(state.found.length===8) winGame();
    }

    // ðŸŽ† Fireworks + Win Message
    function winGame(){
      clearInterval(timer);
      document.getElementById("fireworks").style.display="block";
      document.getElementById("win-message").style.display="block";
      startFireworks();
    }

    function startFireworks(){
      const canvas=document.getElementById("fireworks");
      const ctx=canvas.getContext("2d");
      canvas.width=window.innerWidth;canvas.height=window.innerHeight;
      let particles=[];
      function random(min,max){return Math.random()*(max-min)+min;}
      function createFirework(){
        let x=random(100,canvas.width-100),y=random(50,canvas.height/2);
        for(let i=0;i<100;i++){
          particles.push({x,y,angle:Math.random()*2*Math.PI,speed:random(2,5),life:100,color:`hsl(${Math.random()*360},100%,60%)`});
        }
      }
      function animate(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        particles.forEach((p,i)=>{
          p.x+=Math.cos(p.angle)*p.speed;
          p.y+=Math.sin(p.angle)*p.speed+0.5;
          p.life--;
          ctx.fillStyle=p.color;
          ctx.fillRect(p.x,p.y,2,2);
          if(p.life<=0) particles.splice(i,1);
        });
        if(Math.random()<0.05) createFirework();
        requestAnimationFrame(animate);
      }
      animate();
    }

    // ðŸ”„ Restart game
    function restartGame(){
      clearInterval(timer);
      state=initGame(createAndShuffleDeck());
      document.getElementById("fireworks").style.display="none";
      document.getElementById("win-message").style.display="none";
      render();
    }

    document.getElementById("stock-pile").onclick=deal;
    document.getElementById("restart-btn-top").onclick=restartGame;
    document.getElementById("restart-btn-win").onclick=restartGame;

    state=initGame(createAndShuffleDeck());
    render();
  </script>
</body>
</html>
